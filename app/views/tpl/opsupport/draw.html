<div class="title control-group">
	
	<h3>领用记录</h3>
</div>
<msgbox messages="msgs"></msgbox>
<form class="form-inline" data-toggle="validator">
	<div class="form-group">
		<!--<input class="datepicker" data-date-format="yyyy-mm-dd" ng-model="queryParam.dateBegin">-->
		<div class="input-group">
			<input type="text"
				   class="form-control"
				   ng-model="queryParam.dateBegin"
                   datetime-picker="yyyy-MM-dd HH:mm"
				   is-open="DRAW.dateBeginPickerOpen">
			<div class="input-group-addon" ng-click="DRAW.toggleDateBeginPicker($event)">
				<i class="glyphicon glyphicon-calendar"></i>
			</div>
		</div>
	</div>
	<div class="form-group">
	<label>~</label>
		<!--<input class="datepicker" data-date-format="yyyy-mm-dd" ng-model="queryParam.dateEnd">-->
        <div class="input-group">
            <input type="text"
                   class="form-control"
                   ng-model="queryParam.dateEnd"
                   datetime-picker="yyyy-MM-dd HH:mm"
                   is-open="DRAW.dateEndPickerOpen">
            <div class="input-group-addon" ng-click="DRAW.toggleDateEndPicker($event)">
                <i class="glyphicon glyphicon-calendar"></i>
            </div>
        </div>
	</div>
 	<div class="form-group">
		<input type="text" class="form-control" id="qbarcode"  name="qbarcode" ng-model="queryParam.barcode" placeholder="条形码"/>
    </div>
	<div class="form-group">
		<input type="text" class="form-control" id="qconsumer"  name="qconsumer" ng-model="queryParam.consumer" placeholder="手术间"/>
	</div>
 	<div class="form-group">
		<button type="button" class="btn btn-primary" ng-click="query()">查询</button>
	</div>
	<div class="form-group">
		<button type="button" data-target="#editmodal" data-toggle="modal"  class="btn btn-primary" ng-click="changeEditMode('create')">领用</button>
	</div>
	<div class="form-group">
		<button type="button" data-target="#recyclemodal" data-toggle="modal"  class="btn btn-primary" ng-click="recycle.initRecycleModal()">回收</button>
	</div>
    <div class="form-group">
        <exportbtn data-target="#drawbox"></exportbtn>
    </div>
</form>
<div  id="drawbox">
<table class="table table-bordered table-hover">
	<tr>
		<th>ID</th>
		<th>手术间</th>
		<th>领用人</th>
    	<th>记录人</th>
		<th>记录时间</th>
		<th>备注</th>
		<th>条形码</th>
		<th>使用情况</th>
		<th>回收者</th>
		<th>送还人</th>
		<th>回收时间</th>
    	<th></th>
    </tr>
    <tbody  ng-repeat="draw in draws">
    <tr>
        <td>
    		{{draw.id}}
        </td>
    	<td>
    		{{draw.consumer}}
        </td>
        <td>
    		{{draw.receiver | userFilter}}
        </td>
        <td>
    		{{draw.drawer | userFilter}}
        </td>
        <td>
    		{{draw.drawTime | formatDateFilter}}
        </td>
        <td>
    		{{draw.remark}}
        </td>
        <td>
        </td>
        <td>
        </td>
        <td>
        </td>
        <td>
        </td>
        <td>
            <edit ng-Model="draw"  edit-data="currentedit" ng-click="changeEditMode('edit')"><a data-target="#editmodal" data-toggle="modal"  href="javascript:void(0);">编辑</a></edit>
            <delete ng-Model="draw" ng-hide="!DRAW.isDrawDeletable(draw)"  del-data="currentedit" ng-click="changeEditMode('del')"><a data-target="#delmodal" data-toggle="modal" href="javascript:void(0);">删除</a ></delete>
		</td>
	</tr>
	<tr ng-repeat="drawDetail in draw.drawDetails">
	        <td>
    		 
	        </td>
	    	<td>
	    		 
	        </td>
	        <td>
	    	 
	        </td>
	        <td>
	    	 
	        </td>
	        <td>
	    		 
	        </td>
	        <td>
	    	 
	        </td>
	        <td>
                {{drawDetail.barcode}}
			</td>
			<td>
			    {{drawDetail.useFlag | useTranFilter}}
			</td>
			<td>
			    {{drawDetail.recycle.recycler | userFilter}}
			</td>
            <td>
                {{drawDetail.recycle.returner | userFilter}}
            </td>
			<td>
			    {{drawDetail.recycle.recycleTime | formatDateFilter}}
			</td>
			<td>
			</td>
	</tr>
	</tbody>
</table>
</div>
  <div class="container-fluid">
 <div class="row">
 		<div class="pull-left">
			<pagination 
				total-items="queryParam.totalItems"
				items-per-page="queryParam.pageSize"
				ng-model="queryParam.pageNo"
				class="pagination"
				boundary-links="true"
				max-size ="4"
				first-text="首页"
				previous-text="前页"
				next-text="后页"
				last-text="最后"
				ng-change="query()">
			</pagination>
		</div>
		<div class="btn-group pagination" style="float:left">
		    <button type="button" class="btn btn-default dropdown-toggle" data-target="#test" data-toggle="collapse">
		    设置<span class="caret"></span>
		    </button>
		    <div class="dropdown-menu collapse" id="test">
				<div class="input-group">
			         <span class="input-group-addon">页大小</span>
			         <input type="text" id="pagesize" class="form-control"  name="pagesize" ng-model="queryParam.pageSize" placeholder="页大小"/>
			     </div>
		    </div>
		</div>
 </div>
 </div>
<form  name="dlgform" class="form-horizontal" ng-submit="saveChange(dlgform.$valid)" role="form" novalidate>
<editdlg module-name="领用记录" dlgid="editmodal" is-hide="{{isSaveCompleted}}" module-class="modal-dialog-lg">
<div class="row">
    <div class="col-md-12"> <msgbox messages="DRAW.msgs"></msgbox></div>
	<div class="col-md-4">
		<div class="form-group" >
			<label  for="id" class="col-md-4 control-label">ID</label>
			<div class="col-md-8" >
				<span  id="id" name="id" >{{currentedit.newval.id}}</span>
			</div>
		</div>
		<div class="form-group">
			<label  class="col-md-4 control-label">手术间</label>
			<div class="col-md-8 controls">
                <oproominput oproom="currentedit.newval.consumer"></oproominput>
			    <!--<input type="text" class="form-control" id="consumer"  name="consumer" ng-model="currentedit.newval.consumer" required placeholder="请录入手术间"/>-->
			</div>
		</div>
		<div class="form-group">
			<label class="col-md-4 control-label">领用人</label>
			<div class="col-md-8 controls">
			<pyinput show-columns="DRAW.receiver.showColumns"
					 fullfill-column="legalName"
					 selected-item="DRAW.receiver.selectedItem"
					 py="DRAW.receiver.py"
					 query="DRAW.receiver.queryByPinyin()">
			</pyinput>
			<!--<input type="text" class="form-control" id="receiver"  name="receiver" ng-model="currentedit.newval.receiver" placeholder="请录入领用人"/>-->
			</div>
		</div>
		<div class="form-group">
			<label class="col-md-4 control-label">记录人</label>
			<div class="col-md-8 controls">
            <pyinput show-columns="DRAW.drawer.showColumns"
                     fullfill-column="legalName"
                     selected-item="DRAW.drawer.selectedItem"
                     py="DRAW.drawer.py"
                     query="DRAW.drawer.queryByPinyin()">
            </pyinput>
			<!--<input type="text" class="form-control" id="drawer"  name="drawer" ng-model="currentedit.newval.drawer" required placeholder="请录入记录人"/>-->
			</div>
		</div>
		<div class="form-group">
			<label  for="remark" class="col-md-4 control-label">备注</label>
			<div class="col-md-8 controls">
			<input type="text" class="form-control" id="remark"  name="remark" ng-model="currentedit.newval.remark"/>
			</div>
		</div>
		<div class="form-group">
			<label class="col-md-4 control-label">时间</label>
			<div class="col-md-8 controls">
			{{currentedit.newval.drawTime | formatDateFilter}}
			</div>
		</div>
	</div>
	<div class="col-md-8">
		<input type="text" class="form-control" ng-model="scanner.barcodeCollecter" ng-keypress="addDrawDetail($event, scanner.barcodeCollecter)" placeholder="请扫描条码"/>
		<table class="table table-bordered table-hover">
			<tr>
				<th>条形码</th>
				<th>使用情况</th>
				<th>回收者</th>
				<th>回收时间</th>
		    	<th></th>
		    </tr>
			<tr ng-repeat="drawDetail in currentedit.newval.drawDetails track by $index">
		        <td>
		        	{{drawDetail.barcode}}
				</td>
				<td>
					{{drawDetail.useFlag | useTranFilter}}
				</td>
				<td>
				{{drawDetail.recycle.recycler | userFilter }}{{drawDetail.recycle.id}}
				</td>
				<td>
				 {{drawDetail.recycle.recycleTime | formatDateFilter}}
				</td>
				<td>
				<a
					ng-hide="drawDetail.recycle && !_.isEmpty(drawDetail.recycle.id)"
					ng-click="deleteDrawDetail(currentedit.newval.drawDetails, drawDetail)">删除{{drawDetail.recycle.id}}
				</a >
				</td>
			</tr>
		</table>
	</div>
</div>
</editdlg>
</form>

<deletedlg dlgid="delmodal" is-hide="{{IsHideModal}}" do-del="deleteCurrent()">
	<table class="table table-bordered table-hover">
	    <tr>
		    <td>ID</td>
		     <td>
		 		{{currentedit.newval.id}}
		     </td>
	    </tr>
	    <tr>
		    <td>手术间</td>
		 	<td>
		 		{{currentedit.newval.consumer}}
		     </td>
	    </tr>
	     <tr>
		    <td>领用人</td>
		 	<td>
		 		{{currentedit.newval.receiver | userFilter}}
		     </td>
	    </tr>
	    <tr>
	    	<td>记录人</td>
		 	<td>
		 		{{currentedit.newval.drawer | userFilter}}
		     </td>
	    </tr>
	    <tr>
	    	<td>记录时间</td>
		 	<td>
		 		{{currentedit.newval.drawTime | formatDateFilter}}
		    </td>
	    </tr>
	</table>
</deletedlg>

<form  name="formRecycle" class="form-horizontal" ng-submit="recycle.saveRecycle(formRecycle.$valid)" role="form" novalidate>
<editdlg module-name="回收条形码" dlgid="recyclemodal" is-hide="{{recycle.isRecycleSaved}}" module-class="modal-dialog-lg">
	<div class="row">
        <div class="col-md-12"> <msgbox messages="recycle.msgs"></msgbox></div>
		<div class="col-md-4">
			<div class="form-group">
				<label class="col-md-4 control-label">送还人</label>
				<div class="col-md-8 controls">
                    <pyinput show-columns="recycle.returner.showColumns"
                             fullfill-column="legalName"
                             selected-item="recycle.returner.selectedItem"
                             py="recycle.returner.py"
                             query="recycle.returner.queryByPinyin()">
                    </pyinput>
					<!--<input type="text" class="form-control" id="returner"  name="returner" ng-model="recycle.returner" placeholder="请录入送还人"/>-->
				</div>
			</div>
			<div class="form-group">
				<label class="col-md-4 control-label">记录人</label>
				<div class="col-md-8 controls">
                    <pyinput show-columns="recycle.recycler.showColumns"
                             fullfill-column="legalName"
                             selected-item="recycle.recycler.selectedItem"
                             py="recycle.recycler.py"
                             query="recycle.recycler.queryByPinyin()">
                    </pyinput>
					<!--<input type="text" class="form-control" id="recycler"  name="recycler" ng-model="recycle.recycler" placeholder="请录入记录人"/>-->
				</div>
			</div>
		</div>
		<div class="col-md-8">
			<input type="text" class="form-control" 
				ng-model="recycle.barcodeCollecter"
				ng-keypress="recycle.collectBarcode($event, recycle.barcodeCollecter)" placeholder="请扫描条码"/>
			<table class="table table-bordered table-hover">
				<tr>
					<th>条形码</th>
			    	<th>使用情况(使用√)</th>
			    	<th></th>
			    </tr>
				<tr ng-repeat="detail in recycle.recycleDetails track by $index">
			        <td>
			        	{{detail.barcode}}			        	
					</td>
					<td>
						<input type="checkbox"  ng-model="detail.useFlag" ng-true-value="1" ng-false-value="0"/>
					</td>
					<td>
						<a href="javascript:void(0);" ng-click="recycle.deleteBarcode(recycle.recycleDetails, detail)">删除</a >
					</td>
				</tr>
			</table>
		</div>

	</div>
</editdlg>
</form>

<script type="text/javascript">
$('.datepicker').datepicker({
	format : 'yyyy-mm-dd'
});
</script>



